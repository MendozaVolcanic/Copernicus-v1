<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ∞Ô∏è Sentinel-2 Monitor - Chile</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }
        
        h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.1em;
        }
        
        .volcano-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .volcano-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .volcano-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            font-size: 1.5em;
            font-weight: bold;
        }
        
        .timelapse-container {
            padding: 20px;
        }
        
        .timelapse-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .tab-btn:hover {
            background: #e0e0e0;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .timelapse-content {
            display: none;
        }
        
        .timelapse-content.active {
            display: block;
        }
        
        .timelapse-img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .timelapse-info {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 0.9em;
            color: #555;
        }
        
        .calendar-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }
        
        .calendar-header {
            font-size: 1.8em;
            margin-bottom: 20px;
            color: #333;
        }
        
        .volcano-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1em;
            margin-bottom: 20px;
        }
        
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .calendar-day.header {
            background: #667eea;
            color: white;
            cursor: default;
        }
        
        .calendar-day.empty {
            background: transparent;
            cursor: default;
        }
        
        .calendar-day.no-data {
            background: #f0f0f0;
            color: #999;
            cursor: default;
        }
        
        .calendar-day.downloaded {
            background: #28a745;
            color: white;
        }
        
        .calendar-day.downloaded:hover {
            background: #218838;
            transform: scale(1.05);
        }
        
        .calendar-legend {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 5px;
        }
        
        footer {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            color: #666;
        }
        
        footer p {
            margin: 8px 0;
        }
        
        footer strong {
            color: #333;
        }
        
        @media (max-width: 768px) {
            .volcano-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .calendar {
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üõ∞Ô∏è Sentinel-2 Volcanic Monitor</h1>
            <p class="subtitle">Monitoreo autom√°tico de volcanes chilenos</p>
            <p style="margin-top: 15px; color: #999; font-size: 0.9em;">
                Timelapses √∫ltimos 30 d√≠as | Actualizaci√≥n autom√°tica diaria
            </p>
        </header>
        
        <!-- TIMELAPSES POR VOLC√ÅN -->
        <div class="volcano-grid" id="volcano-grid"></div>
        
        <!-- CALENDARIO DE FECHAS DISPONIBLES -->
        <div class="calendar-section">
            <h2 class="calendar-header">üìÖ Calendario de Im√°genes Disponibles</h2>
            
            <select class="volcano-select" id="volcano-calendar-select" onchange="cargarCalendario()">
                <option value="">Selecciona un volc√°n...</option>
            </select>
            
            <div id="calendar-container"></div>
            
            <div class="calendar-legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #28a745;"></div>
                    <span>Imagen disponible</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f0f0f0;"></div>
                    <span>Sin im√°genes</span>
                </div>
            </div>
        </div>
        
        <footer>
            <p><strong>Datos:</strong> Copernicus Data Space / Sentinel-2 L2A</p>
            <p><strong>Procesamiento:</strong> Sentinel Hub API</p>
            <p><strong>Desarrollo:</strong> Nicol√°s Mendoza</p>
            <p><strong>Asistencia T√©cnica:</strong> Claude (Anthropic)</p>
            <p><strong>Infraestructura:</strong> GitHub Actions + GitHub Pages</p>
            <p style="margin-top: 15px; color: #999;">¬© 2026 - Monitoreo Volc√°nico Chile</p>
        </footer>
    </div>
    
    <script>
        // CONFIGURACI√ìN
        const VOLCANES = {
            'Villarrica': { region: 'Araucan√≠a' },
            'Llaima': { region: 'Araucan√≠a' }
        };
        
        let fechasDisponibles = {};
        
        // ========================================
        // INICIALIZACI√ìN
        // ========================================
        async function init() {
            cargarTimelapses();
            await cargarFechasDisponibles();
            poblarSelectorVolcanes();
        }
        
        // ========================================
        // CARGAR TIMELAPSES AUTOM√ÅTICOS
        // ========================================
        function cargarTimelapses() {
            const grid = document.getElementById('volcano-grid');
            
            for (const [volcan, config] of Object.entries(VOLCANES)) {
                const card = document.createElement('div');
                card.className = 'volcano-card';
                
                const timestamp = new Date().getTime();
                
                card.innerHTML = `
                    <div class="volcano-header">
                        üåã ${volcan} <span style="font-size: 0.7em; font-weight: normal;">(${config.region})</span>
                    </div>
                    <div class="timelapse-container">
                        <div class="timelapse-tabs">
                            <button class="tab-btn active" onclick="cambiarTab(this, '${volcan}', 'RGB')">
                                RGB Color Real
                            </button>
                            <button class="tab-btn" onclick="cambiarTab(this, '${volcan}', 'Thermal')">
                                SWIR Falso Color
                            </button>
                        </div>
                        
                        <div class="timelapse-content active" id="${volcan}-RGB">
                            <img src="timelapses/${volcan}_RGB.gif?t=${timestamp}" 
                                 alt="${volcan} RGB" 
                                 class="timelapse-img"
                                 onerror="this.src='https://via.placeholder.com/800x600?text=Cargando...'"
                            >
                            <div class="timelapse-info">
                                üì∑ Sentinel-2 L2A RGB (B04-B03-B02)<br>
                                üìÖ √öltimos 30 d√≠as<br>
                                üîÑ Actualizaci√≥n autom√°tica diaria
                            </div>
                        </div>
                        
                        <div class="timelapse-content" id="${volcan}-Thermal">
                            <img src="timelapses/${volcan}_ThermalFalseColor.gif?t=${timestamp}" 
                                 alt="${volcan} Thermal" 
                                 class="timelapse-img"
                                 onerror="this.src='https://via.placeholder.com/800x600?text=Cargando...'"
                            >
                            <div class="timelapse-info">
                                üî• Sentinel-2 L2A SWIR (B12-B11-B04)<br>
                                üìÖ √öltimos 30 d√≠as<br>
                                üîÑ Actualizaci√≥n autom√°tica diaria
                            </div>
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            }
        }
        
        function cambiarTab(btn, volcan, tipo) {
            // Desactivar todos los tabs del volc√°n
            const card = btn.closest('.volcano-card');
            card.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            card.querySelectorAll('.timelapse-content').forEach(c => c.classList.remove('active'));
            
            // Activar tab seleccionado
            btn.classList.add('active');
            document.getElementById(`${volcan}-${tipo}`).classList.add('active');
        }
        
        // ========================================
        // CALENDARIO
        // ========================================
        async function cargarFechasDisponibles() {
            try {
                const response = await fetch('fechas_disponibles_copernicus.json?t=' + new Date().getTime());
                fechasDisponibles = await response.json();
                console.log('‚úÖ Fechas cargadas:', fechasDisponibles);
            } catch (error) {
                console.error('‚ùå Error cargando fechas:', error);
                fechasDisponibles = {};
            }
        }
        
        function poblarSelectorVolcanes() {
            const select = document.getElementById('volcano-calendar-select');
            
            for (const volcan in VOLCANES) {
                const option = document.createElement('option');
                option.value = volcan;
                option.textContent = `üåã ${volcan}`;
                select.appendChild(option);
            }
        }
        
        function cargarCalendario() {
            const select = document.getElementById('volcano-calendar-select');
            const volcan = select.value;
            
            if (!volcan) {
                document.getElementById('calendar-container').innerHTML = '';
                return;
            }
            
            const fechas = fechasDisponibles[volcan] || [];
            
            if (fechas.length === 0) {
                document.getElementById('calendar-container').innerHTML = `
                    <p style="text-align: center; padding: 30px; color: #999;">
                        No hay fechas disponibles para ${volcan}
                    </p>
                `;
                return;
            }
            
            // Obtener mes actual
            const ahora = new Date();
            const a√±o = ahora.getFullYear();
            const mes = ahora.getMonth();
            
            generarCalendarioMes(a√±o, mes, fechas);
        }
        
        function generarCalendarioMes(a√±o, mes, fechas) {
            const primerDia = new Date(a√±o, mes, 1);
            const ultimoDia = new Date(a√±o, mes + 1, 0);
            const diasMes = ultimoDia.getDate();
            const primerDiaSemana = primerDia.getDay();
            
            const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                          'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            
            let html = `
                <h3 style="text-align: center; margin: 20px 0;">
                    ${meses[mes]} ${a√±o}
                </h3>
                <div class="calendar">
                    <div class="calendar-day header">Dom</div>
                    <div class="calendar-day header">Lun</div>
                    <div class="calendar-day header">Mar</div>
                    <div class="calendar-day header">Mi√©</div>
                    <div class="calendar-day header">Jue</div>
                    <div class="calendar-day header">Vie</div>
                    <div class="calendar-day header">S√°b</div>
            `;
            
            // D√≠as vac√≠os al inicio
            for (let i = 0; i < primerDiaSemana; i++) {
                html += '<div class="calendar-day empty"></div>';
            }
            
            // D√≠as del mes
            for (let dia = 1; dia <= diasMes; dia++) {
                const fecha = `${a√±o}-${String(mes + 1).padStart(2, '0')}-${String(dia).padStart(2, '0')}`;
                const tieneImagen = fechas.includes(fecha);
                
                if (tieneImagen) {
                    html += `
                        <div class="calendar-day downloaded" 
                             title="Imagen disponible: ${fecha}"
                             onclick="verImagenFecha('${fecha}')">
                            ${dia}
                        </div>
                    `;
                } else {
                    html += `
                        <div class="calendar-day no-data" title="Sin im√°genes: ${fecha}">
                            ${dia}
                        </div>
                    `;
                }
            }
            
            html += '</div>';
            document.getElementById('calendar-container').innerHTML = html;
        }
        
        function verImagenFecha(fecha) {
            const volcan = document.getElementById('volcano-calendar-select').value;
            alert(`üìÖ Fecha: ${fecha}\nüåã Volc√°n: ${volcan}\n\n‚úÖ Imagen disponible en repositorio`);
            // Aqu√≠ podr√≠as abrir un modal o navegar a la imagen espec√≠fica
        }
        
        // INICIAR AL CARGAR
        window.onload = init;
    </script>
</body>
</html>
