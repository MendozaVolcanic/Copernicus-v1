<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ∞Ô∏è Sentinel-2 Volcanic Monitor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: linear-gradient(135deg, #0b0e14 0%, #1a1f2e 100%);
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
        }

        /* MODO TIMELAPSE FULLSCREEN */
        body.timelapse-mode #main-content {
            display: none;
        }
        
        body.timelapse-mode #timelapse-fullscreen {
            display: flex !important;
        }

        /* HEADER */
        header {
            background: linear-gradient(90deg, #161b22 0%, #1f2937 100%);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid #58a6ff;
            box-shadow: 0 4px 20px rgba(88, 166, 255, 0.3);
        }

        header h1 {
            color: #58a6ff;
            font-size: 2em;
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(88, 166, 255, 0.5);
        }

        header p {
            color: #8b949e;
            font-size: 0.9em;
        }

        /* BARRA DE ESTADO */
        #status-bar {
            background: #161b22;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #30363d;
            flex-wrap: wrap;
            gap: 10px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85em;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-weight: bold;
        }

        .badge-active {
            background: #2ea043;
            color: #fff;
        }

        .btn-ui {
            background: #30363d;
            color: white;
            border: 1px solid #444;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            margin-left: 5px;
            transition: all 0.3s;
        }

        .btn-ui:hover {
            background: #444c56;
        }

        .btn-active {
            background: #238636 !important;
            border-color: #2ea043;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        /* SELECTOR DE VOLC√ÅN + CALENDARIO */
        #volcano-selector {
            background: #161b22;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 1px solid #30363d;
            flex-wrap: wrap;
        }

        #volcano-selector label {
            font-weight: bold;
            color: #58a6ff;
        }

        #volcano-selector select, #volcano-selector button {
            background: #0d1117;
            color: #e0e0e0;
            border: 1px solid #30363d;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
        }

        /* NUEVA SECCI√ìN: TIMELAPSES AUTOM√ÅTICOS */
        #timelapse-automatico {
            background: #161b22;
            padding: 20px;
            margin: 20px;
            border-radius: 10px;
            border: 2px solid #58a6ff;
        }

        #timelapse-automatico h2 {
            color: #58a6ff;
            margin-bottom: 15px;
            text-align: center;
        }

        .timelapse-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .timelapse-card {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 15px;
        }

        .timelapse-card h3 {
            color: #58a6ff;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .timelapse-card img {
            width: 100%;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .timelapse-info {
            font-size: 0.85em;
            color: #8b949e;
            line-height: 1.6;
        }

        /* CALENDARIO MODAL */
        #calendar-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }

        .calendar-content {
            background: #161b22;
            border: 2px solid #58a6ff;
            border-radius: 10px;
            padding: 20px;
            max-width: 450px;
            width: 90%;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-header h3 {
            color: #58a6ff;
            margin: 0;
        }

        .close-btn {
            background: #ff4500;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-weight: bold;
        }

        .calendar-selectors {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .calendar-selectors select {
            flex: 1;
            background: #0d1117;
            color: #e0e0e0;
            border: 1px solid #30363d;
            padding: 8px;
            border-radius: 6px;
        }

        #calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 10px;
        }

        .calendar-day-header {
            text-align: center;
            color: #8b949e;
            font-size: 0.85em;
            font-weight: bold;
            padding: 8px;
        }

        .calendar-day {
            padding: 8px;
            text-align: center;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .calendar-day.downloaded {
            background: #2ea043;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
        }

        .calendar-day.downloaded:hover {
            background: #3fb950;
            transform: scale(1.1);
        }

        .calendar-day.available {
            background: #58a6ff;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
        }

        .calendar-day.available:hover {
            background: #79c0ff;
            transform: scale(1.1);
        }

        .calendar-day.unavailable {
            background: #30363d;
            color: #6e7681;
            cursor: not-allowed;
        }

        .calendar-legend {
            margin-top: 15px;
            font-size: 0.8em;
            display: flex;
            gap: 15px;
            justify-content: center;
            color: #8b949e;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-box {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }

        /* TIMELINE */
        #timeline-container {
            background: #0d1117;
            padding: 20px;
            margin: 20px;
            border-radius: 10px;
        }

        #timeline {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .timeline-item {
            min-width: 120px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            padding: 5px;
            border-radius: 6px;
            transition: all 0.3s;
        }

        .timeline-item:hover {
            border-color: #58a6ff;
        }

        .timeline-item.selected {
            border-color: #58a6ff;
            background: rgba(88, 166, 255, 0.1);
        }

        .timeline-thumb {
            width: 100%;
            height: 80px;
            object-fit: cover;
            border-radius: 4px;
        }

        .timeline-date {
            font-size: 0.75em;
            margin-top: 5px;
            color: #8b949e;
        }

        /* VISUALIZADOR PRINCIPAL */
        #main-viewer {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 20px;
            flex-wrap: wrap;
        }

        .image-panel {
            flex: 1;
            min-width: 400px;
            background: #161b22;
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #30363d;
        }

        .image-panel h3 {
            color: #58a6ff;
            margin-bottom: 10px;
            text-align: center;
        }

        .main-image {
            width: 100%;
            border-radius: 8px;
            cursor: pointer;
        }

        /* FULLSCREEN TIMELAPSE */
        #timelapse-fullscreen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: #000;
            z-index: 2000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #fullscreen-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 2001;
        }

        #timelapse-gif {
            max-width: 90%;
            max-height: 80vh;
            border-radius: 10px;
        }

        .fullscreen-btn {
            background: rgba(22, 27, 34, 0.9);
            color: white;
            border: 1px solid #58a6ff;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .fullscreen-btn:hover {
            background: #58a6ff;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .timelapse-grid {
                grid-template-columns: 1fr;
            }
            
            .image-panel {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div id="main-content">
        <header>
            <h1>üõ∞Ô∏è Sentinel-2 Volcanic Monitor</h1>
            <p>Sistema de Monitoreo Autom√°tico - Volcanes de Chile</p>
        </header>

        <div id="status-bar">
            <div class="status-item">
                <strong>Sistema:</strong>
                <span class="status-badge badge-active" id="system-status">OPERATIVO</span>
            </div>
            
            <div class="action-buttons">
                <button class="btn-ui" onclick="toggleCalendar()">üìÖ Calendario</button>
                <button class="btn-ui" onclick="descargarPPT()">üìä PPT Mensual</button>
                <button class="btn-ui" onclick="abrirCopernicusBrowser()">üåç Copernicus Browser</button>
            </div>

            <div class="status-item">
                <strong>√öltima actualizaci√≥n:</strong>
                <span id="last-update">Cargando...</span>
            </div>
        </div>

        <div id="volcano-selector">
            <label for="volcano-select">üåã Volc√°n:</label>
            <select id="volcano-select" onchange="cambiarVolcan()">
                <option value="Villarrica">Villarrica</option>
                <option value="Llaima">Llaima</option>
            </select>
        </div>

        <!-- NUEVA SECCI√ìN: TIMELAPSES AUTOM√ÅTICOS √öLTIMOS 30 D√çAS -->
        <div id="timelapse-automatico">
            <h2>üé¨ Timelapses Autom√°ticos (√öltimos 30 d√≠as)</h2>
            <p style="text-align: center; color: #8b949e; margin-bottom: 15px;">
                Se actualizan autom√°ticamente cada d√≠a
            </p>
            
            <div class="timelapse-grid">
                <div class="timelapse-card">
                    <h3>üñºÔ∏è RGB Color Real</h3>
                    <img id="timelapse-rgb-auto" 
                         src="" 
                         alt="Timelapse RGB"
                         onclick="verTimelapseFullscreen('RGB')"
                         style="cursor: pointer;">
                    <div class="timelapse-info">
                        üì∑ Sentinel-2 L2A RGB (B04-B03-B02)<br>
                        üìÖ √öltimos 30 d√≠as<br>
                        üîÑ Actualizado: <span id="update-date-rgb">--</span>
                    </div>
                </div>

                <div class="timelapse-card">
                    <h3>üî• SWIR Falso Color</h3>
                    <img id="timelapse-thermal-auto" 
                         src="" 
                         alt="Timelapse Thermal"
                         onclick="verTimelapseFullscreen('Thermal')"
                         style="cursor: pointer;">
                    <div class="timelapse-info">
                        üå°Ô∏è Sentinel-2 L2A SWIR (B12-B11-B04)<br>
                        üìÖ √öltimos 30 d√≠as<br>
                        üîÑ Actualizado: <span id="update-date-thermal">--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- TIMELINE ORIGINAL (IM√ÅGENES INDIVIDUALES) -->
        <div id="timeline-container">
            <h3 style="color: #58a6ff; margin-bottom: 10px;">üìÖ Timeline de Im√°genes</h3>
            <div id="timeline"></div>
        </div>

        <!-- VISUALIZADOR PRINCIPAL -->
        <div id="main-viewer">
            <div class="image-panel">
                <h3>üñºÔ∏è RGB</h3>
                <img id="main-rgb" class="main-image" src="" alt="RGB Image">
            </div>
            
            <div class="image-panel">
                <h3>üî• Thermal False Color</h3>
                <img id="main-thermal" class="main-image" src="" alt="Thermal Image">
            </div>
        </div>
    </div>

    <!-- CALENDARIO MODAL -->
    <div id="calendar-modal" onclick="closeCalendarIfOutside(event)">
        <div class="calendar-content" onclick="event.stopPropagation()">
            <div class="calendar-header">
                <h3>üìÖ Calendario</h3>
                <button class="close-btn" onclick="toggleCalendar()">‚úï</button>
            </div>
            
            <div class="calendar-selectors">
                <select id="calendar-month" onchange="updateCalendar()">
                    <option value="0">Enero</option>
                    <option value="1">Febrero</option>
                    <option value="2">Marzo</option>
                    <option value="3">Abril</option>
                    <option value="4">Mayo</option>
                    <option value="5">Junio</option>
                    <option value="6">Julio</option>
                    <option value="7">Agosto</option>
                    <option value="8">Septiembre</option>
                    <option value="9">Octubre</option>
                    <option value="10">Noviembre</option>
                    <option value="11">Diciembre</option>
                </select>
                
                <select id="calendar-year" onchange="updateCalendar()"></select>
            </div>
            
            <div id="calendar-grid">
                <div class="calendar-day-header">Dom</div>
                <div class="calendar-day-header">Lun</div>
                <div class="calendar-day-header">Mar</div>
                <div class="calendar-day-header">Mi√©</div>
                <div class="calendar-day-header">Jue</div>
                <div class="calendar-day-header">Vie</div>
                <div class="calendar-day-header">S√°b</div>
            </div>
            
            <div class="calendar-legend">
                <div class="legend-item">
                    <div class="legend-box" style="background: #2ea043;"></div>
                    <span>Ya descargada</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box" style="background: #58a6ff;"></div>
                    <span>Disponible en Copernicus</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box" style="background: #30363d;"></div>
                    <span>No disponible</span>
                </div>
            </div>
        </div>
    </div>

    <!-- FULLSCREEN TIMELAPSE -->
    <div id="timelapse-fullscreen">
        <div id="fullscreen-controls">
            <button class="fullscreen-btn" onclick="cerrarFullscreen()">‚úï Cerrar</button>
        </div>
        <img id="timelapse-gif" src="" alt="Timelapse">
    </div>

    <script>
        // CONFIGURACI√ìN
        const VOLCANES_CONFIG = {
            'Villarrica': { lat: -39.42, lon: -71.93 },
            'Llaima': { lat: -38.69, lon: -71.73 }
        };

        let currentVolcano = 'Villarrica';
        let availableDates = [];
        let selectedDate = null;
        let calendarMonth = new Date().getMonth();
        let calendarYear = new Date().getFullYear();
        let fechasDisponiblesCopernicus = {};

        // ========================================
        // INICIALIZACI√ìN
        // ========================================
        async function init() {
            await cargarDatosVolcan(currentVolcano);
            await cargarTimelapesAutomaticos(currentVolcano);
            initCalendar();
        }

        // ========================================
        // TIMELAPSES AUTOM√ÅTICOS
        // ========================================
        async function cargarTimelapesAutomaticos(volcano) {
            const timestamp = new Date().getTime();
            
            const imgRGB = document.getElementById('timelapse-rgb-auto');
            const imgThermal = document.getElementById('timelapse-thermal-auto');
            
            imgRGB.src = `timelapses/${volcano}_RGB.gif?t=${timestamp}`;
            imgThermal.src = `timelapses/${volcano}_ThermalFalseColor.gif?t=${timestamp}`;
            
            // Actualizar fechas de actualizaci√≥n
            const ahora = new Date().toLocaleDateString('es-CL');
            document.getElementById('update-date-rgb').textContent = ahora;
            document.getElementById('update-date-thermal').textContent = ahora;
        }

        function verTimelapseFullscreen(tipo) {
            const tipoArchivo = tipo === 'RGB' ? 'RGB' : 'ThermalFalseColor';
            const timestamp = new Date().getTime();
            
            document.getElementById('timelapse-gif').src = 
                `timelapses/${currentVolcano}_${tipoArchivo}.gif?t=${timestamp}`;
            
            document.body.classList.add('timelapse-mode');
        }

        function cerrarFullscreen() {
            document.body.classList.remove('timelapse-mode');
        }

        // ========================================
        // CARGAR DATOS DEL VOLC√ÅN
        // ========================================
        async function cargarDatosVolcan(volcano) {
            try {
                const response = await fetch(`data/sentinel2/${volcano}/metadata.csv?t=${new Date().getTime()}`);
                const text = await response.text();
                const lines = text.split('\n').filter(l => l.trim());
                
                availableDates = [];
                lines.slice(1).forEach(line => {
                    const cols = line.split(',');
                    if (cols.length >= 2) {
                        const fecha = cols[0].trim();
                        if (!availableDates.includes(fecha)) {
                            availableDates.push(fecha);
                        }
                    }
                });
                
                availableDates.sort().reverse();
                
                if (availableDates.length > 0) {
                    selectedDate = availableDates[0];
                    renderTimeline();
                    cargarImagenes(selectedDate);
                    document.getElementById('last-update').textContent = selectedDate;
                }
                
                await cargarFechasDisponiblesCopernicus(volcano);
                
            } catch (error) {
                console.error('Error cargando datos:', error);
                document.getElementById('last-update').textContent = 'Error';
            }
        }

        // ========================================
        // TIMELINE
        // ========================================
        function renderTimeline() {
            const timeline = document.getElementById('timeline');
            timeline.innerHTML = '';
            
            availableDates.slice(0, 20).forEach(date => {
                const item = document.createElement('div');
                item.className = 'timeline-item';
                if (date === selectedDate) item.classList.add('selected');
                
                const img = document.createElement('img');
                img.className = 'timeline-thumb';
                img.src = `data/sentinel2/${currentVolcano}/RGB/${date}_RGB.png`;
                img.onerror = () => img.src = 'https://via.placeholder.com/120x80?text=N/A';
                
                const dateLabel = document.createElement('div');
                dateLabel.className = 'timeline-date';
                dateLabel.textContent = date;
                
                item.appendChild(img);
                item.appendChild(dateLabel);
                item.onclick = () => selectDate(date);
                
                timeline.appendChild(item);
            });
        }

        function selectDate(date) {
            selectedDate = date;
            renderTimeline();
            cargarImagenes(date);
        }

        function cargarImagenes(date) {
            const imgRGB = document.getElementById('main-rgb');
            const imgThermal = document.getElementById('main-thermal');
            
            const timestamp = new Date().getTime();
            imgRGB.src = `data/sentinel2/${currentVolcano}/RGB/${date}_RGB.png?t=${timestamp}`;
            imgThermal.src = `data/sentinel2/${currentVolcano}/ThermalFalseColor/${date}_ThermalFalseColor.png?t=${timestamp}`;
        }

        // ========================================
        // CAMBIO DE VOLC√ÅN
        // ========================================
        async function cambiarVolcan() {
            currentVolcano = document.getElementById('volcano-select').value;
            await cargarDatosVolcan(currentVolcano);
            await cargarTimelapesAutomaticos(currentVolcano);
            updateCalendar();
        }

        // ========================================
        // CALENDARIO CON COPERNICUS
        // ========================================
        async function cargarFechasDisponiblesCopernicus(volcano) {
            try {
                const response = await fetch(`fechas_disponibles_copernicus.json?t=${new Date().getTime()}`);
                if (response.ok) {
                    const data = await response.json();
                    fechasDisponiblesCopernicus = data;
                    console.log('‚úÖ Fechas Copernicus cargadas');
                }
            } catch (error) {
                console.error('Error cargando fechas Copernicus:', error);
                fechasDisponiblesCopernicus = {};
            }
        }

        function toggleCalendar() {
            const modal = document.getElementById('calendar-modal');
            if (modal.style.display === 'flex') {
                modal.style.display = 'none';
            } else {
                modal.style.display = 'flex';
                updateCalendar();
            }
        }

        function closeCalendarIfOutside(event) {
            if (event.target.id === 'calendar-modal') {
                toggleCalendar();
            }
        }

        async function initCalendar() {
            const yearSelect = document.getElementById('calendar-year');
            yearSelect.innerHTML = '';
            
            const currentYear = new Date().getFullYear();
            for (let year = currentYear - 2; year <= currentYear + 1; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === currentYear) option.selected = true;
                yearSelect.appendChild(option);
            }
            
            calendarMonth = new Date().getMonth();
            calendarYear = currentYear;
            document.getElementById('calendar-month').value = calendarMonth;
        }

        function updateCalendar() {
            calendarMonth = parseInt(document.getElementById('calendar-month').value);
            calendarYear = parseInt(document.getElementById('calendar-year').value);
            
            const grid = document.getElementById('calendar-grid');
            
            // Limpiar solo los d√≠as, mantener headers
            const dayElements = grid.querySelectorAll('.calendar-day');
            dayElements.forEach(el => el.remove());
            
            const firstDay = new Date(calendarYear, calendarMonth, 1);
            const lastDay = new Date(calendarYear, calendarMonth + 1, 0);
            const startDay = firstDay.getDay();
            
            // Obtener fechas disponibles de Copernicus
            const fechasCopernicus = fechasDisponiblesCopernicus[currentVolcano] || [];
            
            // D√≠as vac√≠os al inicio
            for (let i = 0; i < startDay; i++) {
                const emptyDiv = document.createElement('div');
                emptyDiv.className = 'calendar-day';
                grid.appendChild(emptyDiv);
            }
            
            // D√≠as del mes
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dateStr = `${calendarYear}-${String(calendarMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                const yaDescargada = availableDates.includes(dateStr);
                const disponibleCopernicus = fechasCopernicus.includes(dateStr);
                
                const dayDiv = document.createElement('div');
                dayDiv.textContent = day;
                dayDiv.className = 'calendar-day';
                
                if (yaDescargada) {
                    dayDiv.classList.add('downloaded');
                    dayDiv.onclick = () => {
                        selectDate(dateStr);
                        toggleCalendar();
                    };
                } else if (disponibleCopernicus) {
                    dayDiv.classList.add('available');
                    dayDiv.onclick = () => abrirCopernicusBrowserFecha(dateStr);
                } else {
                    dayDiv.classList.add('unavailable');
                }
                
                grid.appendChild(dayDiv);
            }
        }

        function abrirCopernicusBrowserFecha(fecha) {
            const config = VOLCANES_CONFIG[currentVolcano];
            
            if (confirm(`üîµ FECHA DISPONIBLE EN COPERNICUS\n\n` +
                       `Volc√°n: ${currentVolcano}\n` +
                       `Fecha: ${fecha}\n\n` +
                       `¬øAbrir Copernicus Browser para ver esta imagen?`)) {
                
                const url = `https://browser.dataspace.copernicus.eu/?` +
                    `zoom=13&` +
                    `lat=${config.lat}&` +
                    `lng=${config.lon}&` +
                    `themeId=DEFAULT-THEME&` +
                    `datasetId=S2_L2A_CDAS&` +
                    `fromTime=${fecha}T00:00:00.000Z&` +
                    `toTime=${fecha}T23:59:59.999Z&` +
                    `layerId=1_TRUE_COLOR&` +
                    `cloudCoverage=30`;
                
                window.open(url, '_blank');
            }
        }

        // ========================================
        // BOTONES AUXILIARES
        // ========================================
        function descargarPPT() {
            const ahora = new Date();
            const a√±o = ahora.getFullYear();
            const mes = String(ahora.getMonth() + 1).padStart(2, '0');
            const monthStr = `${a√±o}-${mes}`;
            
            const pptUrl = `PPT_Mensuales/${currentVolcano}_${monthStr}.pptx`;
            
            if (confirm(`üìä DESCARGAR PPT EVALUACI√ìN MENSUAL\n\n` +
                       `Volc√°n: ${currentVolcano}\n` +
                       `Mes: ${monthStr}\n\n` +
                       `¬øDescargar PPT?`)) {
                
                const a = document.createElement('a');
                a.href = pptUrl;
                a.download = `${currentVolcano}_Evaluacion_Mensual_${monthStr}.pptx`;
                a.click();
            }
        }

        function abrirCopernicusBrowser() {
            const config = VOLCANES_CONFIG[currentVolcano];
            
            const today = new Date();
            const thirtyDaysAgo = new Date(today);
            thirtyDaysAgo.setDate(today.getDate() - 30);
            
            const fromTime = thirtyDaysAgo.toISOString().split('.')[0] + 'Z';
            const toTime = today.toISOString().split('.')[0] + 'Z';
            
            const url = `https://browser.dataspace.copernicus.eu/?` +
                `zoom=13&` +
                `lat=${config.lat}&` +
                `lng=${config.lon}&` +
                `themeId=DEFAULT-THEME&` +
                `datasetId=S2_L2A_CDAS&` +
                `fromTime=${fromTime}&` +
                `toTime=${toTime}&` +
                `layerId=1_TRUE_COLOR&` +
                `cloudCoverage=30`;
            
            window.open(url, '_blank');
        }

        window.onload = init;
    </script>
</body>
</html>
